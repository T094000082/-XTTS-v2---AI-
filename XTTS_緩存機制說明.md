# XTTS v2 緩存機制說明

## 🚀 緩存優化概述

為了解決 XTTS v2 每次執行都要重新下載模型的問題，我們實現了兩層緩存機制：

### 📁 磁盤緩存（Disk Cache）
- **位置**: `%USERPROFILE%\.cache\tts\tts_models--multilingual--multi-dataset--xtts_v2`
- **大小**: 約 1.8GB
- **說明**: 首次使用時會自動下載並保存到本地，之後無需重新下載

### 💾 記憶體緩存（Memory Cache）
- **位置**: 程式記憶體中的全局變數
- **說明**: 同一程式執行期間，多次初始化會直接使用已載入的模型

## 🔄 工作流程

### 首次使用（全新安裝）
1. 檢查磁盤緩存 ❌ 不存在
2. 下載模型到磁盤緩存 📥 (~1.8GB)
3. 載入模型到記憶體緩存 🧠
4. 完成初始化 ✅

**預期時間**: 5-15分鐘（取決於網路速度）

### 第二次使用（有磁盤緩存）
1. 檢查磁盤緩存 ✅ 已存在
2. 載入模型到記憶體緩存 🧠
3. 完成初始化 ✅

**預期時間**: 30-60秒

### 同程式內重複使用（有記憶體緩存）
1. 檢查記憶體緩存 ✅ 已存在
2. 直接使用緩存模型 ⚡
3. 完成初始化 ✅

**預期時間**: < 1秒

## 🔍 如何檢查緩存狀態

### 方法1: 圖形界面
1. 開啟增強版讀稿機
2. 點擊「緩存狀態」按鈕
3. 查看詳細的緩存資訊

### 方法2: 命令行
```bash
python tts_enhanced.py --info
```

### 方法3: 測試腳本
```bash
python test_xtts_cache.py
```

## 📊 性能提升效果

| 情況 | 首次載入 | 緩存載入 | 提升倍數 |
|------|----------|----------|----------|
| 磁盤緩存 | 5-15分鐘 | 30-60秒 | 5-15x |
| 記憶體緩存 | 30-60秒 | <1秒 | 30-60x |

## 🛠️ 故障排除

### Q: 模型每次都重新下載？
**A**: 檢查以下項目：
1. 網路連線是否穩定
2. 磁盤空間是否足夠（需要2GB以上）
3. 防毒軟體是否阻擋了模型下載
4. 用戶目錄權限是否正常

### Q: 緩存模型損壞怎麼辦？
**A**: 刪除緩存目錄重新下載：
```bash
# Windows
rmdir /s "%USERPROFILE%\.cache\tts"

# 或手動刪除資料夾
```

### Q: 如何清除記憶體緩存？
**A**: 重啟程式即可清除記憶體緩存

## 💡 最佳使用建議

1. **首次使用**: 選擇網路穩定的時候進行，確保模型完整下載
2. **日常使用**: 使用圖形界面時，建議初始化一次引擎後重複使用
3. **批次處理**: 在命令行模式下處理多個文件時，記憶體緩存會自動生效
4. **空間管理**: 如需清理磁盤空間，可刪除 `~\.cache\tts` 目錄

## 🔄 版本更新

### v1.1 (當前版本)
- ✅ 新增磁盤緩存檢測
- ✅ 新增記憶體緩存機制
- ✅ 新增緩存狀態顯示
- ✅ 優化載入速度提示

### v1.0 (原始版本)
- ❌ 每次都重新下載模型
- ❌ 載入時間長

---

**💡 提示**: 這個緩存機制大大改善了 XTTS v2 的使用體驗，讓高品質AI語音合成變得更加實用！
